<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOID CIRCUIT</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #080808; /* Slightly lighter than pitch black */
            font-family: 'Orbitron', sans-serif;
            color: white;
            user-select: none;
        }

        #ui-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        canvas { display: block; }

        /* HUD */
        #hud {
            position: absolute;
            top: 20px; left: 20px;
            pointer-events: none;
        }
        .hud-item {
            font-size: 20px;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
            letter-spacing: 2px;
        }
        #currency-display { color: #d400ff; } /* Purple for Bits */
        
        /* MENUS */
        .menu-box {
            pointer-events: auto;
            background: rgba(15, 15, 20, 0.95);
            border: 2px solid #00f0ff;
            box-shadow: 0 0 40px rgba(0, 240, 255, 0.15);
            padding: 40px;
            border-radius: 4px;
            text-align: center;
            min-width: 400px;
            display: none; 
        }

        h1 { 
            margin: 0 0 5px 0; 
            font-size: 50px; 
            color: #fff; 
            text-shadow: 0 0 20px #00f0ff; 
            font-weight: 900;
            font-style: italic;
        }
        h2 { 
            color: #d400ff; /* Purple Subtitle */
            margin: 0 0 30px 0; 
            font-size: 14px; 
            letter-spacing: 8px;
            text-transform: uppercase;
        }

        button {
            background: linear-gradient(90deg, #111, #222);
            color: #00f0ff;
            border: 1px solid #00f0ff;
            padding: 15px 30px;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            cursor: pointer;
            transition: 0.2s;
            margin: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            width: 80%;
            font-weight: bold;
        }
        button:hover { 
            background: #00f0ff; 
            color: #000; 
            box-shadow: 0 0 25px #00f0ff; 
        }
        button:disabled { border-color: #555; color: #555; cursor: not-allowed; box-shadow: none; background: #111; }

        input[type="text"] {
            background: #000; border: 2px solid #333; color: #fff;
            font-family: 'Orbitron', sans-serif; font-size: 20px;
            padding: 10px; text-align: center; width: 70%;
            text-transform: uppercase; outline: none; margin-bottom: 10px;
        }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #333; }
        th { color: #888; font-size: 12px; }
        td { color: #fff; font-size: 16px; }
        tr:nth-child(1) td { color: #d400ff; text-shadow: 0 0 10px #d400ff; font-weight: bold;}

    </style>
</head>
<body>

    <div id="hud">
        <div class="hud-item" style="color:#00f0ff">SCORE: <span id="score-val">0</span></div>
        <div class="hud-item" id="currency-display">DATA: <span id="bits-val">0</span></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        
        <div id="main-menu" class="menu-box" style="display: block;">
            <h1>VOID CIRCUIT</h1>
            <h2>INFINITE RUNNER</h2>
            <p style="color:#888; margin-bottom:20px; font-size: 12px;">DATA COLLECTED: <span id="menu-currency" style="color:#d400ff">0</span></p>
            
            <button onclick="startGame()">INITIATE SEQUENCE</button>
            <button onclick="openShop()">SYSTEM UPGRADES</button>
            <button onclick="openLeaderboard()">LOCAL RECORDS</button>
        </div>

        <div id="shop-menu" class="menu-box">
            <h1 style="font-size:30px; color:#d400ff; text-shadow:0 0 20px #a0f;">SYSTEM CORE</h1>
            <p>AVAILABLE DATA: <span id="shop-currency" style="color:#fff">0</span></p>
            <div id="upgrade-grid"></div>
            <button onclick="closeShop()" style="margin-top:20px;">RETURN</button>
        </div>

        <div id="leaderboard-menu" class="menu-box">
            <h1 style="font-size:30px; color:#00f0ff;">LOCAL ARCHIVE</h1>
            <p style="font-size:10px; color:#666; margin-bottom:15px;">SCORES SAVED TO THIS DEVICE</p>
            <table>
                <thead>
                    <tr><th>RANK</th><th>PILOT</th><th>SCORE</th></tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
            <br>
            <button onclick="closeLeaderboard()">RETURN</button>
        </div>

        <div id="game-over-menu" class="menu-box">
            <h1 style="color:#f33; text-shadow:0 0 20px #f00;">SIGNAL LOST</h1>
            <h2 id="final-score-display" style="color:#fff; letter-spacing: 2px;">SCORE: 0</h2>
            
            <div id="input-container">
                <input type="text" id="player-name" placeholder="PILOT ID" maxlength="10">
                <div id="error-msg" style="color:red; font-size:12px; height:15px; margin-bottom:5px;"></div>
                <button onclick="submitScore()" id="submit-btn">SAVE RECORD</button>
            </div>
            
            <button onclick="returnToMenu()" style="border-color:#555; color:#aaa; margin-top:20px;">MAIN MENU</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- GAME CONSTANTS ---
    const COLORS = {
        cyan: '#00f0ff',
        purple: '#d400ff',
        red: '#ff003c',
        bg: '#080808'
    };

    const BLOCKLIST = ["ADMIN", "MOD", "SEX", "XXX", "PORN", "FUCK", "SHIT", "BITCH", "NIGGA"];

    // --- SAVE DATA (LOCAL STORAGE ONLY) ---
    // Changed key to 'voidCircuit_v1' to act as a fresh start
    const defaultData = { 
        currency: 0, 
        upgrades: { damage: 1, fireRate: 1, speed: 1 },
        highScores: [] // Local array for scores
    };
    
    let saveData = JSON.parse(localStorage.getItem('voidCircuit_v1')) || defaultData;

    function saveGame() {
        localStorage.setItem('voidCircuit_v1', JSON.stringify(saveData));
        updateUI();
    }

    const UPGRADES = [
        { id: 'damage', name: 'CORE VOLTAGE', base: 100 },
        { id: 'fireRate', name: 'CYCLE SPEED', base: 150 },
        { id: 'speed', name: 'THRUSTER SYNC', base: 100 }
    ];

    // --- LOCAL LEADERBOARD LOGIC ---
    function validateName(name) {
        if(name.length < 3) return "ID TOO SHORT";
        for(let word of BLOCKLIST) if(name.toUpperCase().includes(word)) return "INVALID ID";
        return "OK";
    }

    function submitScore() {
        const nameInput = document.getElementById('player-name');
        const name = nameInput.value.toUpperCase().trim();
        const errDiv = document.getElementById('error-msg');
        const validation = validateName(name);

        if(validation !== "OK") { errDiv.innerText = validation; return; }

        const scoreVal = Math.floor(score);
        
        // Save to local array
        saveData.highScores.push({ name: name, score: scoreVal });
        
        // Sort by score (High to Low)
        saveData.highScores.sort((a, b) => b.score - a.score);
        
        // Keep top 10 only
        saveData.highScores = saveData.highScores.slice(0, 10);
        
        saveGame(); // Write to disk

        // Transition UI
        document.getElementById('game-over-menu').style.display = 'none';
        openLeaderboard();
        nameInput.value = ""; // Clear input
    }

    function openLeaderboard() {
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('game-over-menu').style.display = 'none';
        document.getElementById('leaderboard-menu').style.display = 'block';
        
        const tbody = document.getElementById('leaderboard-body');
        tbody.innerHTML = '';

        if (saveData.highScores.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">NO DATA FOUND</td></tr>';
            return;
        }

        saveData.highScores.forEach((e, i) => {
            tbody.innerHTML += `<tr><td>${i+1}</td><td>${e.name}</td><td>${e.score}</td></tr>`;
        });
    }

    function closeLeaderboard() {
        document.getElementById('leaderboard-menu').style.display = 'none';
        document.getElementById('main-menu').style.display = 'block';
    }

    // --- GAME ENGINE ---
    let gameState = 'MENU';
    let score = 0;
    let frames = 0;
    let player;
    let projectiles = [];
    let enemies = [];
    let particles = [];
    let mouse = { x: 0, y: 0 };
    const keys = { w:false, a:false, s:false, d:false, space:false };

    window.addEventListener('keydown', e => {
        if(e.key === 'w' || e.key === 'ArrowUp') keys.w = true; 
        if(e.key === 'a' || e.key === 'ArrowLeft') keys.a = true;
        if(e.key === 's' || e.key === 'ArrowDown') keys.s = true; 
        if(e.key === 'd' || e.key === 'ArrowRight') keys.d = true;
        if(e.code === 'Space') keys.space = true;
    });
    window.addEventListener('keyup', e => {
        if(e.key === 'w' || e.key === 'ArrowUp') keys.w = false; 
        if(e.key === 'a' || e.key === 'ArrowLeft') keys.a = false;
        if(e.key === 's' || e.key === 'ArrowDown') keys.s = false; 
        if(e.key === 'd' || e.key === 'ArrowRight') keys.d = false;
        if(e.code === 'Space') keys.space = false;
    });
    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    window.addEventListener('mousedown', () => keys.space = true);
    window.addEventListener('mouseup', () => keys.space = false);

    class Player {
        constructor() {
            this.x = canvas.width/2; this.y = canvas.height/2;
            this.radius = 12;
            this.speed = 4 * saveData.upgrades.speed;
            this.lastShot = 0;
        }
        update() {
            if(keys.w && this.y > 0) this.y -= this.speed;
            if(keys.s && this.y < canvas.height) this.y += this.speed;
            if(keys.a && this.x > 0) this.x -= this.speed;
            if(keys.d && this.x < canvas.width) this.x += this.speed;
            
            // Auto fire if holding space
            if(keys.space && frames - this.lastShot > (15 / saveData.upgrades.fireRate)) {
                const angle = Math.atan2(mouse.y - this.y, mouse.x - this.x);
                projectiles.push(new Projectile(this.x, this.y, Math.cos(angle)*12, Math.sin(angle)*12));
                this.lastShot = frames;
            }
        }
        draw() {
            // Player is a triangle
            const angle = Math.atan2(mouse.y - this.y, mouse.x - this.x);
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(angle);
            ctx.beginPath();
            ctx.moveTo(15, 0); ctx.lineTo(-10, 10); ctx.lineTo(-5, 0); ctx.lineTo(-10, -10);
            ctx.fillStyle = COLORS.cyan; ctx.shadowBlur = 15; ctx.shadowColor = COLORS.cyan; ctx.fill();
            ctx.restore();
        }
    }

    class Projectile {
        constructor(x, y, vx, vy) { this.x=x; this.y=y; this.vx=vx; this.vy=vy; this.dead=false; }
        update() { this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>canvas.width||this.y<0||this.y>canvas.height) this.dead=true; }
        draw() { ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI*2); ctx.fillStyle = '#fff'; ctx.shadowBlur=5; ctx.shadowColor='#fff'; ctx.fill(); }
    }

    class Enemy {
        constructor() {
            if(Math.random()<0.5) { this.x = Math.random()<0.5 ? -30 : canvas.width+30; this.y = Math.random()*canvas.height; }
            else { this.x = Math.random()*canvas.width; this.y = Math.random()<0.5 ? -30 : canvas.height+30; }
            this.angle = Math.atan2(player.y - this.y, player.x - this.x);
            // Difficulty scaling
            const difficultyMult = 1 + (score/1000);
            this.vx = Math.cos(this.angle) * (2 * difficultyMult);
            this.vy = Math.sin(this.angle) * (2 * difficultyMult);
            this.dead = false;
        }
        update() {
            const dx = player.x - this.x; const dy = player.y - this.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            // Simple homing
            this.x += (dx/dist) * (1.5 + score/500);
            this.y += (dy/dist) * (1.5 + score/500);
            
            if(dist < 20) { gameOver(); }
        }
        draw() {
            ctx.beginPath(); 
            // Enemy is a diamond shape
            ctx.moveTo(this.x, this.y-12); ctx.lineTo(this.x+12, this.y); 
            ctx.lineTo(this.x, this.y+12); ctx.lineTo(this.x-12, this.y);
            ctx.fillStyle = COLORS.red; ctx.shadowBlur = 10; ctx.shadowColor = COLORS.red; ctx.fill();
        }
    }

    class Particle {
        constructor(x, y, color) {
            this.x=x; this.y=y; this.color=color; this.alpha=1;
            this.vx=(Math.random()-0.5)*8; this.vy=(Math.random()-0.5)*8;
            this.life = Math.random() * 0.05 + 0.02; // decay rate
        }
        update() { this.x+=this.vx; this.y+=this.vy; this.alpha-=this.life; }
        draw() { ctx.globalAlpha=Math.max(0, this.alpha); ctx.fillStyle=this.color; ctx.fillRect(this.x,this.y,3,3); ctx.globalAlpha=1; }
    }

    function loop() {
        if(gameState !== 'PLAYING') return;
        
        // Trail effect
        ctx.fillStyle = 'rgba(8, 8, 8, 0.2)'; 
        ctx.fillRect(0,0,canvas.width,canvas.height);
        
        player.update(); player.draw();
        
        // Spawn rate
        if(frames % Math.max(15, 60 - Math.floor(score/50)) === 0) enemies.push(new Enemy());
        
        projectiles.forEach(p => p.update());
        enemies.forEach(e => e.update());
        particles.forEach(p => p.update());

        // Collisions
        projectiles.forEach(p => {
            enemies.forEach(e => {
                const dist = Math.hypot(p.x - e.x, p.y - e.y);
                if(dist < 20) {
                    p.dead = true; e.dead = true; score += 10; saveData.currency += 1;
                    // Explosion particles
                    for(let i=0; i<6; i++) particles.push(new Particle(e.x, e.y, COLORS.red));
                    for(let i=0; i<2; i++) particles.push(new Particle(e.x, e.y, '#fff'));
                }
            });
        });

        projectiles = projectiles.filter(p => !p.dead);
        enemies = enemies.filter(e => !e.dead);
        particles = particles.filter(p => p.alpha > 0);
        
        projectiles.forEach(p => p.draw());
        enemies.forEach(e => e.draw());
        particles.forEach(p => p.draw());

        document.getElementById('score-val').innerText = score;
        document.getElementById('bits-val').innerText = saveData.currency;
        frames++;
        requestAnimationFrame(loop);
    }

    function startGame() {
        player = new Player(); projectiles = []; enemies = []; particles = [];
        score = 0; frames = 0;
        document.getElementById('main-menu').style.display = 'none';
        gameState = 'PLAYING'; loop();
    }

    function gameOver() {
        gameState = 'MENU'; saveGame();
        document.getElementById('final-score-display').innerText = "FINAL SCORE: " + score;
        document.getElementById('game-over-menu').style.display = 'block';
    }

    function returnToMenu() {
        document.getElementById('game-over-menu').style.display = 'none';
        document.getElementById('main-menu').style.display = 'block';
        updateUI();
    }

    // SHOP LOGIC
    function openShop() { document.getElementById('main-menu').style.display='none'; document.getElementById('shop-menu').style.display='block'; renderShop(); }
    function closeShop() { document.getElementById('shop-menu').style.display='none'; document.getElementById('main-menu').style.display='block'; updateUI(); }
    
    function renderShop() {
        const grid = document.getElementById('upgrade-grid'); grid.innerHTML = '';
        document.getElementById('shop-currency').innerText = saveData.currency;
        
        UPGRADES.forEach(u => {
            const level = (saveData.upgrades[u.id] - 1) * 10;
            const cost = Math.floor(u.base * Math.pow(1.5, level/2));
            const btn = document.createElement('button');
            btn.innerHTML = `${u.name} <span style="color:#d400ff">LVL ${level/2}</span><br><span style="color:#fff; font-size:10px;">REQ: ${cost} DATA</span>`;
            btn.onclick = () => {
                if(saveData.currency >= cost) {
                    saveData.currency -= cost;
                    saveData.upgrades[u.id] += 0.2;
                    saveGame(); renderShop();
                } else alert("INSUFFICIENT DATA");
            };
            grid.appendChild(btn);
        });
    }

    function updateUI() { document.getElementById('menu-currency').innerText = saveData.currency; }
    updateUI();

</script>
</body>
</html>
